# üé¨ YouTube ELT Pipeline - Data Engineering Project

[![CI/CD](https://github.com/Saidouchrif/YouTube-ELT-Pipeline-Data-Engineering-/workflows/CI/badge.svg)](https://github.com/Saidouchrif/YouTube-ELT-Pipeline-Data-Engineering-/actions)
[![Python 3.11](https://img.shields.io/badge/python-3.11-blue.svg)](https://www.python.org/downloads/)
[![Apache Airflow](https://img.shields.io/badge/Apache%20Airflow-2.7.3-red.svg)](https://airflow.apache.org/)
[![MongoDB](https://img.shields.io/badge/MongoDB-7.0-green.svg)](https://www.mongodb.com/)

## üìã Table des Mati√®res

- [üéØ Vue d'ensemble](#-vue-densemble)
- [üèóÔ∏è Architecture du Syst√®me](#Ô∏è-architecture-du-syst√®me)
- [üöÄ D√©marrage Rapide](#-d√©marrage-rapide)
- [üìä Pipelines de Donn√©es](#-pipelines-de-donn√©es)
- [üîß Configuration](#-configuration)
- [üóÑÔ∏è Mod√®le de Donn√©es](#Ô∏è-mod√®le-de-donn√©es)
- [üîç Qualit√© des Donn√©es](#-qualit√©-des-donn√©es)
- [üê≥ D√©ploiement Docker](#-d√©ploiement-docker)
- [üß™ Tests](#-tests)
- [üìà Monitoring](#-monitoring)
- [üîí S√©curit√©](#-s√©curit√©)
- [ü§ù Contribution](#-contribution)

## üéØ Vue d'ensemble

Pipeline ELT (Extract, Load, Transform) moderne et scalable pour l'extraction, la transformation et l'analyse des donn√©es YouTube. Ce projet impl√©mente une architecture compl√®te de data engineering avec :

- **Extraction automatis√©e** des donn√©es YouTube via l'API v3
- **Transformation et nettoyage** des donn√©es avec validation qualit√©
- **Stockage optimis√©** dans MongoDB avec historisation SCD2
- **Orchestration robuste** avec Apache Airflow
- **Validation qualit√©** avec Soda Core
- **Infrastructure containeris√©e** avec Docker

### üéØ Objectifs du Projet

- Extraire les m√©tadonn√©es des vid√©os YouTube (vues, likes, commentaires, etc.)
- Impl√©menter un pipeline de donn√©es scalable et maintenable
- Assurer la qualit√© des donn√©es avec des tests automatis√©s
- Fournir une architecture pr√™te pour la production
- D√©montrer les meilleures pratiques en data engineering

## üèóÔ∏è Architecture du Syst√®me

### üìê Diagramme d'Architecture

```mermaid
graph TB
    subgraph "Data Sources"
        YT[YouTube API v3]
    end
    
    subgraph "Orchestration Layer"
        AF[Apache Airflow]
        DAG1[produce_JSON]
        DAG2[update_db]
        DAG3[data_quality]
        DAG4[data_validation_pipeline]
    end
    
    subgraph "Processing Layer"
        EXT[Extract Module]
        TRANS[Transform Module]
        LOAD[Load Module]
    end
    
    subgraph "Storage Layer"
        STAGING[(staging_data)]
        CORE[(core_data)]
        HISTORY[(history_data)]
    end
    
    subgraph "Quality Layer"
        SODA[Soda Core]
        VALID[Data Validation]
    end
    
    subgraph "Infrastructure"
        DOCKER[Docker Containers]
        MONGO[MongoDB 7.0]
        API[FastAPI Service]
    end
    
    YT --> EXT
    EXT --> AF
    AF --> DAG1
    AF --> DAG2
    AF --> DAG3
    AF --> DAG4
    
    DAG1 --> STAGING
    DAG2 --> TRANS
    TRANS --> CORE
    TRANS --> HISTORY
    DAG3 --> SODA
    DAG4 --> VALID
    
    STAGING --> MONGO
    CORE --> MONGO
    HISTORY --> MONGO
    
    MONGO --> DOCKER
    AF --> DOCKER
    API --> DOCKER
```

### üîß Composants Principaux

#### 1. **Couche d'Orchestration (Apache Airflow)**
- **produce_JSON.py** : Extraction des donn√©es YouTube ‚Üí JSON timestamp√©s
- **update_db.py** : Transformation staging ‚Üí core + historisation
- **data_quality.py** : Tests qualit√© avec Soda Core
- **data_validation_pipeline.py** : Pipeline int√©gr√© avec alertes

#### 2. **Modules de Traitement (`plugins/youtube_elt/`)**
- **extract.py** : Extraction API YouTube avec gestion quotas
- **transform.py** : Nettoyage et standardisation des donn√©es
- **load.py** : Chargement MongoDB avec UPSERT
- **db.py** : Utilitaires de connexion MongoDB

#### 3. **Couche de Stockage (MongoDB)**
- **staging_data** : Donn√©es brutes extraites
- **core_data** : Donn√©es transform√©es et nettoy√©es
- **history_data** : Historisation SCD2 avec versioning

#### 4. **Validation Qualit√© (Soda Core)**
- Tests de compl√©tude des donn√©es
- Validation des formats et types
- D√©tection des doublons
- Contr√¥les de coh√©rence m√©tier

## üöÄ D√©marrage Rapide

### üìã Pr√©requis

- **Docker** 20.10+ et **Docker Compose** 2.0+
- **Python** 3.11+
- **Cl√© API YouTube Data v3** ([Obtenir une cl√©](https://developers.google.com/youtube/v3/getting-started))
- **Git** pour cloner le repository

### ‚ö° Installation Express

#### Option 1: Script Automatique (Recommand√©)
```powershell
# Windows PowerShell
.\start-project.ps1

# Pour arr√™ter le projet
.\stop-project.ps1
```

#### Option 2: Installation Manuelle
```bash
# 1. Cloner le repository
git clone https://github.com/Saidouchrif/YouTube-ELT-Pipeline-Data-Engineering-.git
cd YouTube-ELT-Pipeline-Data-Engineering-

# 2. Copier et configurer les variables d'environnement
cp .env.example .env
# √âditer .env avec votre cl√© API YouTube

# 3. D√©marrer l'infrastructure compl√®te
docker-compose -f docker-compose.final.yml up -d

# 4. V√©rifier que tous les services sont actifs
docker-compose -f docker-compose.final.yml ps
```

### üåê Acc√®s aux Services

| Service | URL | Credentials |
|---------|-----|-------------|
| **Airflow Web UI** | http://localhost:8080 | admin / admin |
| **MongoDB** | localhost:27017 | admin / password123 |
| **Mongo Express** | http://localhost:8081 | admin / admin123 |
| **FastAPI** | http://localhost:8000 | - |

## üìä Pipelines de Donn√©es

### üîÑ Workflow Principal

```mermaid
sequenceDiagram
    participant YT as YouTube API
    participant AF as Airflow
    participant ST as Staging DB
    participant CR as Core DB
    participant HT as History DB
    participant SQ as Soda Quality

    AF->>YT: 1. Extract video data
    YT-->>AF: JSON response
    AF->>ST: 2. Load raw data
    AF->>CR: 3. Transform & load clean data
    AF->>HT: 4. Maintain SCD2 history
    AF->>SQ: 5. Run quality checks
    SQ-->>AF: Quality report
```

### üìà DAGs Disponibles

#### 1. **produce_JSON** - Extraction des Donn√©es
```python
# Fr√©quence: @daily
# Dur√©e: ~2-5 minutes
# Quota API: ~100-500 unit√©s
```
- Extraction via YouTube API v3
- Sauvegarde JSON timestamp√©
- Gestion automatique des quotas
- Retry logic int√©gr√©

#### 2. **update_db** - Transformation et Chargement
```python
# Fr√©quence: @daily (apr√®s produce_JSON)
# Dur√©e: ~1-3 minutes
# D√©pendances: staging_data
```
- Lecture des donn√©es staging
- Transformation et nettoyage
- Chargement avec UPSERT
- Historisation SCD2

#### 3. **data_quality** - Validation Qualit√©
```python
# Fr√©quence: @daily
# Dur√©e: ~30 secondes
# Tests: 15+ r√®gles qualit√©
```
- Tests de compl√©tude
- Validation des formats
- D√©tection des anomalies
- Alertes automatiques

#### 4. **data_validation_pipeline** - Pipeline Int√©gr√©
```python
# Fr√©quence: @daily
# Dur√©e: ~5-10 minutes
# Workflow: Validation ‚Üí Transform ‚Üí Load
```
- Pipeline bout-en-bout
- Validation pr√©alable
- Arr√™t s√©curis√© si √©chec
- Rapport consolid√©

## üîß Configuration

### üîê Variables d'Environnement

Cr√©ez un fichier `.env` bas√© sur `.env.example` :

```bash
# YouTube API Configuration
YOUTUBE_API_KEY=votre_cle_api_youtube
YOUTUBE_CHANNEL_HANDLE=MrBeast
YOUTUBE_MAX_RESULTS=50
YOUTUBE_QUOTA_LIMIT=10000

# MongoDB Configuration
MONGO_HOST=mongodb
MONGO_PORT=27017
MONGO_USERNAME=admin
MONGO_PASSWORD=password123
MONGO_DATABASE=youtube_data

# Paths Configuration
DATA_STAGING_PATH=/data/staging/
DATA_PROCESSED_PATH=/data/processed/

# Retry Configuration
RETRY_ATTEMPTS=3
RETRY_DELAY=5

# Logging Configuration
LOG_LEVEL=INFO
LOG_FORMAT=json
```

### ‚öôÔ∏è Configuration Avanc√©e

#### Airflow Variables (Production)
```bash
# Via Airflow UI ou CLI
airflow variables set YOUTUBE_API_KEY "votre_cle_secrete"
airflow variables set YOUTUBE_CHANNEL_HANDLE "MrBeast"
airflow variables set YOUTUBE_MAX_RESULTS "100"
```

#### Soda Core Configuration
```yaml
# soda/checks/checks_mongo.yml
checks for staging_data:
  - row_count > 0
  - missing_count(video_id) = 0
  - duplicate_count(video_id) = 0

checks for core_data:
  - row_count > 0
  - missing_count(title) = 0
  - invalid_count(view_count) = 0:
      valid min: 0
```

## üóÑÔ∏è Mod√®le de Donn√©es

### üìä Sch√©ma des Collections

#### **staging_data** - Donn√©es Brutes
```json
{
  "_id": "ObjectId",
  "video_id": "dQw4w9WgXcQ",
  "title": "Never Gonna Give You Up",
  "description": "Official video...",
  "published_at": "2009-10-25T06:57:33Z",
  "duration": "PT3M33S",
  "view_count": 1400000000,
  "like_count": 15000000,
  "comment_count": 2800000,
  "thumbnail_url": "https://...",
  "channel_id": "UCuAXFkgsw1L7xaCfnd5JJOw",
  "channel_title": "Rick Astley",
  "tags": ["music", "80s"],
  "_ingested_at": "2025-01-01T12:00:00Z"
}
```

#### **core_data** - Donn√©es Transform√©es
```json
{
  "_id": "ObjectId",
  "video_id": "dQw4w9WgXcQ",
  "title": "Never Gonna Give You Up",
  "description": "Official video...",
  "published_at": "2009-10-25T06:57:33Z",
  "duration_seconds": 213,
  "view_count": 1400000000,
  "like_count": 15000000,
  "comment_count": 2800000,
  "thumbnail_url": "https://...",
  "channel_id": "UCuAXFkgsw1L7xaCfnd5JJOw",
  "channel_title": "Rick Astley",
  "tags": ["music", "80s"],
  "content_type": "standard",
  "created_at": "2025-01-01T12:00:00Z",
  "updated_at": "2025-01-01T12:00:00Z"
}
```

#### **history_data** - Historisation SCD2
```json
{
  "_id": "ObjectId",
  "video_id": "dQw4w9WgXcQ",
  "title": "Never Gonna Give You Up",
  "view_count": 1400000000,
  "like_count": 15000000,
  "comment_count": 2800000,
  "valid_from": "2025-01-01T12:00:00Z",
  "valid_to": null,
  "created_at": "2025-01-01T12:00:00Z",
  "updated_at": "2025-01-01T12:00:00Z"
}
```

### üîç Index MongoDB

```javascript
// Index pour performance
db.staging_data.createIndex({"video_id": 1}, {unique: true})
db.core_data.createIndex({"video_id": 1}, {unique: true})
db.history_data.createIndex({"video_id": 1, "valid_from": 1})

// Index pour requ√™tes temporelles
db.core_data.createIndex({"published_at": -1})
db.history_data.createIndex({"valid_from": -1, "valid_to": 1})
```

## üîç Qualit√© des Donn√©es

### üìã Tests Automatis√©s

#### **Tests de Compl√©tude**
- ‚úÖ Pr√©sence des champs obligatoires
- ‚úÖ Validation des types de donn√©es
- ‚úÖ Contr√¥le des valeurs nulles
- ‚úÖ V√©rification des formats

#### **Tests de Coh√©rence**
- ‚úÖ Valeurs num√©riques positives
- ‚úÖ Formats de dates ISO 8601
- ‚úÖ Longueurs de cha√Ænes valides
- ‚úÖ Relations entre champs

#### **Tests d'Unicit√©**
- ‚úÖ Pas de doublons sur video_id
- ‚úÖ Int√©grit√© r√©f√©rentielle
- ‚úÖ Contraintes m√©tier

### üö® Alertes et Monitoring

```python
# Configuration des alertes
QUALITY_THRESHOLDS = {
    "min_records": 1,
    "max_null_percentage": 5,
    "max_duplicate_percentage": 0,
    "freshness_hours": 24
}

# Actions en cas d'√©chec
- Arr√™t du pipeline
- Notification par email/Slack
- Logging d√©taill√©
- Rollback automatique
```

## üê≥ D√©ploiement Docker

### üèóÔ∏è Architecture des Conteneurs

```yaml
services:
  # Base de donn√©es
  mongodb:
    image: mongo:7.0
    ports: ["27017:27017"]
    
  # Interface MongoDB
  mongo-express:
    image: mongo-express:1.0.0
    ports: ["8081:8081"]
    
  # API FastAPI
  youtube-api:
    build: .
    ports: ["8000:8000"]
    
  # Orchestrateur Airflow
  airflow-standalone:
    image: apache/airflow:2.7.3-python3.11
    ports: ["8080:8080"]
```

### üöÄ Commandes de D√©ploiement

```bash
# D√©marrage complet
docker-compose -f docker-compose.final.yml up -d

# V√©rification des services
docker-compose -f docker-compose.final.yml ps

# Logs en temps r√©el
docker-compose -f docker-compose.final.yml logs -f

# Arr√™t propre
docker-compose -f docker-compose.final.yml down

# Nettoyage complet (donn√©es incluses)
docker-compose -f docker-compose.final.yml down -v
```

### üîß Debugging

```bash
# Acc√®s aux conteneurs
docker exec -it youtube_airflow bash
docker exec -it youtube_mongodb mongosh

# V√©rification des logs
docker logs youtube_airflow --tail 100
docker logs youtube_mongodb --tail 50

# Test de connectivit√©
docker exec youtube_airflow python -c "from youtube_elt.db import get_mongo_client; print('MongoDB OK')"
```

### üö® D√©pannage des Probl√®mes Courants

#### **Probl√®me: Erreur d'installation Soda Core**
```bash
# Solution: Utiliser requirements-ci.txt pour CI/CD
pip install -r requirements-ci.txt

# Ou installer Soda Core s√©par√©ment
pip install soda-core
```

#### **Probl√®me: Conteneur Airflow ne d√©marre pas**
```bash
# V√©rifier les logs
docker logs youtube_airflow

# Red√©marrer le conteneur
docker-compose -f docker-compose.final.yml restart youtube_airflow
```

#### **Probl√®me: MongoDB connection refused**
```bash
# V√©rifier que MongoDB est d√©marr√©
docker-compose -f docker-compose.final.yml ps

# Red√©marrer MongoDB
docker-compose -f docker-compose.final.yml restart mongodb
```

#### **Probl√®me: API YouTube quota exceeded**
```bash
# V√©rifier votre quota dans Google Cloud Console
# Ajuster YOUTUBE_MAX_RESULTS dans .env
# Modifier la fr√©quence des DAGs
```

## üß™ Tests

### üî¨ Suite de Tests

```bash
# Installation des d√©pendances de test
pip install -r requirements.txt

# Ex√©cution de tous les tests
pytest tests/ -v

# Tests avec couverture (CI/CD)
pytest tests/ --cov=plugins --cov-report=xml

# Tests sp√©cifiques par module
pytest tests/test_extract.py -v     # Tests d'extraction
pytest tests/test_transform.py -v  # Tests de transformation
pytest tests/test_load.py -v       # Tests de chargement
pytest tests/test_db.py -v         # Tests de base de donn√©es
pytest tests/test_config.py -v     # Tests de configuration

# Tests par cat√©gorie
pytest -m unit tests/              # Tests unitaires uniquement
pytest -m integration tests/       # Tests d'int√©gration uniquement
```

### üìä Types de Tests

#### **Tests Unitaires** (20+ tests)
- Extraction API YouTube
- Transformation des donn√©es
- Chargement MongoDB
- Validation qualit√©

#### **Tests d'Int√©gration**
- Pipeline bout-en-bout
- Connectivit√© MongoDB
- API YouTube
- DAGs Airflow

#### **Tests de Performance**
- Temps d'ex√©cution
- Utilisation m√©moire
- Throughput donn√©es
- Quotas API

## üìà Monitoring

### üìä M√©triques Cl√©s

```python
# M√©triques de performance
- Temps d'ex√©cution des DAGs
- Nombre de vid√©os trait√©es
- Taux de succ√®s/√©chec
- Utilisation des quotas API

# M√©triques de qualit√©
- Pourcentage de donn√©es valides
- Nombre d'anomalies d√©tect√©es
- Fra√Æcheur des donn√©es
- Compl√©tude des champs
```

### üîî Alertes Configur√©es

- **√âchec de DAG** ‚Üí Notification imm√©diate
- **Quota API √©puis√©** ‚Üí Alerte pr√©ventive
- **Qualit√© d√©grad√©e** ‚Üí Rapport d√©taill√©
- **Panne service** ‚Üí Escalade automatique

## üîí S√©curit√©

### üõ°Ô∏è Bonnes Pratiques

- **Secrets** stock√©s dans variables Airflow
- **Authentification** MongoDB avec utilisateur d√©di√©
- **Chiffrement** des communications
- **Logs** sans donn√©es sensibles
- **Acc√®s** restreint aux services

### üîê Configuration S√©curis√©e

```bash
# Variables sensibles (ne pas commiter)
YOUTUBE_API_KEY=secret
MONGO_PASSWORD=secret

# Utilisation de Docker secrets
docker secret create youtube_api_key api_key.txt
```

## üìÅ Structure du Projet

```
YouTube-ELT-Pipeline-Data-Engineering-/
‚îú‚îÄ‚îÄ üìÅ dags/                          # DAGs Airflow
‚îÇ   ‚îú‚îÄ‚îÄ produce_JSON.py               # Extraction YouTube
‚îÇ   ‚îú‚îÄ‚îÄ update_db.py                  # Transformation & Load
‚îÇ   ‚îú‚îÄ‚îÄ data_quality.py               # Tests qualit√©
‚îÇ   ‚îî‚îÄ‚îÄ data_validation_pipeline.py   # Pipeline int√©gr√©
‚îú‚îÄ‚îÄ üìÅ plugins/youtube_elt/           # Modules r√©utilisables
‚îÇ   ‚îú‚îÄ‚îÄ extract.py                    # Extraction API
‚îÇ   ‚îú‚îÄ‚îÄ transform.py                  # Transformation
‚îÇ   ‚îú‚îÄ‚îÄ load.py                       # Chargement MongoDB
‚îÇ   ‚îî‚îÄ‚îÄ db.py                         # Utilitaires DB
‚îú‚îÄ‚îÄ üìÅ config/                        # Configuration
‚îÇ   ‚îú‚îÄ‚îÄ settings.py                   # Settings centralis√©s
‚îÇ   ‚îî‚îÄ‚îÄ soda_config.yml              # Config Soda Core
‚îú‚îÄ‚îÄ üìÅ soda/checks/                   # Tests qualit√©
‚îÇ   ‚îî‚îÄ‚îÄ checks_mongo.yml             # R√®gles validation
‚îú‚îÄ‚îÄ üìÅ data/staging/                  # Donn√©es temporaires
‚îú‚îÄ‚îÄ üìÅ mongodb-init/                  # Scripts d'initialisation
‚îÇ   ‚îî‚îÄ‚îÄ init.js                      # Setup collections
‚îú‚îÄ‚îÄ üìÅ Keys/                          # API et utilitaires
‚îÇ   ‚îú‚îÄ‚îÄ Api/                         # FastAPI service
‚îÇ   ‚îú‚îÄ‚îÄ Data/                        # Donn√©es d'exemple
‚îÇ   ‚îî‚îÄ‚îÄ quota_manager.py             # Gestion quotas
‚îú‚îÄ‚îÄ üê≥ docker-compose.final.yml       # Infrastructure Docker
‚îú‚îÄ‚îÄ üê≥ Dockerfile.airflow             # Image Airflow custom
‚îú‚îÄ‚îÄ üìã requirements.txt               # D√©pendances Python
‚îú‚îÄ‚îÄ ‚öôÔ∏è .env.example                   # Template configuration
‚îú‚îÄ‚îÄ üîß astro.yaml                     # Config Astro CLI
‚îî‚îÄ‚îÄ üìñ README.md                      # Documentation
```

## ü§ù Contribution

### üîÑ Workflow de D√©veloppement

```bash
# 1. Fork et clone
git clone https://github.com/votre-username/YouTube-ELT-Pipeline-Data-Engineering-.git

# 2. Cr√©er une branche
git checkout -b feature/nouvelle-fonctionnalite

# 3. D√©velopper et tester
pytest tests/ -v

# 4. Commit et push
git commit -m "feat: ajouter nouvelle fonctionnalit√©"
git push origin feature/nouvelle-fonctionnalite

# 5. Cr√©er une Pull Request
```

### üìù Standards de Code

- **PEP 8** pour le style Python
- **Type hints** obligatoires
- **Docstrings** pour toutes les fonctions
- **Tests** pour toute nouvelle fonctionnalit√©
- **Logging** appropri√©

### üêõ Signalement de Bugs

Utilisez les [GitHub Issues](https://github.com/Saidouchrif/YouTube-ELT-Pipeline-Data-Engineering-/issues) avec :
- Description d√©taill√©e
- √âtapes de reproduction
- Logs d'erreur
- Environnement (OS, versions)

## üìû Support

- **Documentation** : Ce README et commentaires dans le code
- **Issues** : [GitHub Issues](https://github.com/Saidouchrif/YouTube-ELT-Pipeline-Data-Engineering-/issues)
- **Discussions** : [GitHub Discussions](https://github.com/Saidouchrif/YouTube-ELT-Pipeline-Data-Engineering-/discussions)

## üìÑ Licence

Ce projet est sous licence **MIT**. Voir le fichier [LICENSE](LICENSE) pour plus de d√©tails.

---

<div align="center">

**üé¨ YouTube ELT Pipeline - Data Engineering Project**

*D√©velopp√© avec ‚ù§Ô∏è pour la communaut√© data engineering*

[![GitHub stars](https://img.shields.io/github/stars/Saidouchrif/YouTube-ELT-Pipeline-Data-Engineering-?style=social)](https://github.com/Saidouchrif/YouTube-ELT-Pipeline-Data-Engineering-/stargazers)
[![GitHub forks](https://img.shields.io/github/forks/Saidouchrif/YouTube-ELT-Pipeline-Data-Engineering-?style=social)](https://github.com/Saidouchrif/YouTube-ELT-Pipeline-Data-Engineering-/network/members)

</div>
